filter {
#################### Test Private ASN - Snippet start - Destination
# If enabled lookup destination Autonomous System.
if [@metadata][private_asn_lookup] == "true" {
  if [flow][dst_asn] == "1123" {
    # Lookup destination Autonomous System.
    geoip {
        id => "elastiflow_postproc_local_geoip_dst_private_asn"
        source => "[flow][dst_addr]"
        database => "${ELASTIFLOW_GEOIP_DB_PATH:/etc/logstash/elastiflow/geoipdbs}/HEAnet-ClientASN.mmdb" ##### Add Private ASN
        cache_size => "${ELASTIFLOW_GEOIP_CACHE_SIZE:8192}"
        target => "[metadata][local_geoip_dst]"
        }
    if [metadata][local_geoip_dst][as_org] {
      if [metadata][local_geoip_dst][asn] {
          mutate {
          id => "elastiflow_postproc_local_dst_as_from_as_org_asn"
          add_field => { "[flow][local_dst_autonomous_system]" => "%{[metadata][[local_geoip_dst][as_org]} (%{[metadata][local_geoip_dst][asn]})" }
          }
        } else {
            mutate {
              id => "elastiflow_postproc_local_dst_as_from_as_org"
              add_field => { "[flow][local_dst_autonomous_system]" => "%{[metadata][local_geoip_dst][as_org]}" }
              }
          }
    } else if [metadata][local_geoip_dst][asn] {
        mutate {
          id => "elastiflow_postproc_local_dst_as_from_asn"
          add_field => { "[flow][local_dst_autonomous_system]" => "%{[metadata][local_geoip_dst][asn]}" }
          }
        } else {
           mutate {
              add_field => { "[flow][local_dst_autonomous_system]" => "public" }
              }
          }
        mutate {
          id => "elastiflow_local_dst_asn"
          rename => { "[metadata][local_geoip_dst][asn]" => "[flow][local_dst_asn]" }
          }
  }
} else {
    mutate {
      id => "elastiflow_postproc_local_no_dst_asn_lookup"
      add_field => { "[flow][local_dst_autonomous_system]" => "public (%{[metadata][local_geoip_dst][asn]})" }
      }
    }
mutate {
    add_field => {
    "[flow][local_autonomous_system]" => "%{[flow][local_dst_autonomous_system]}"
    }
}
                #################### Test Private ASN - Snippet start - Source
# If enabled lookup destination Autonomous System.
if [@metadata][private_asn_lookup] == "true" {
  if [flow][src_asn] == "1123" {
   # Lookup destination Autonomous System.
    geoip {
        id => "elastiflow_postproc_local_geoip_src_private_asn"
        source => "[flow][src_addr]"
        database => "${ELASTIFLOW_GEOIP_DB_PATH:/etc/logstash/elastiflow/geoipdbs}/HEAnet-ClientASN.mmdb" ##### Add Private ASN
        cache_size => "${ELASTIFLOW_GEOIP_CACHE_SIZE:8192}"
        target => "[metadata][local_geoip_src]"
        }
    if [metadata][local_geoip_src][as_org] {
        if [metadata][local_geoip_src][asn] {
          mutate {
            id => "elastiflow_postproc_local_src_as_from_as_org_asn"
            add_field => { "[flow][local_src_autonomous_system]" => "%{[metadata][[local_geoip_src][as_org]} (%{[metadata][local_geoip_src][asn]})" }
            }
        } else {
            mutate {
              id => "elastiflow_postproc_local_src_as_from_as_org"
              add_field => { "[flow][local_src_autonomous_system]" => "%{[metadata][local_geoip_src][as_org]}" }
              }
          }
    } else if [metadata][local_geoip_src][asn] {
        mutate {
          id => "elastiflow_postproc_local_src_as_from_asn"
          add_field => { "[flow][local_src_autonomous_system]" => "%{[metadata][local_geoip_src][asn]}" }
          }
        } else {
            mutate {
              add_field => { "[flow][local_src_autonomous_system]" => "public" }
              }
          }
    mutate {
      id => "elastiflow_local_src_asn"
      rename => { "[metadata][local_geoip_src][asn]" => "[flow][local_src_asn]" }
      }
  }
} else {
    mutate {
      id => "elastiflow_postproc_local_no_src_asn_lookup"
      add_field => { "[flow][local_src_autonomous_system]" => "public (%{[metadata][local_geoip_src][asn]})" }
      }
   }
mutate {
  add_field => { "[flow][local_autonomous_system]" => "%{[flow][local_src_autonomous_system]}"
  }
}

}